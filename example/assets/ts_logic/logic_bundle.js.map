{
  "version": 3,
  "sources": ["../../../ts_sdk/dist/bridge.js", "../../../ts_sdk/dist/states.js", "../../../ts_sdk/dist/api.js", "../../../ts_sdk/dist/actions.js", "../../../ts_sdk/dist/index.js", "../../ts_logic/src/todoLogic.ts", "../../ts_logic/src/index.ts"],
  "sourcesContent": ["/**\n * FlutterBridge - Core communication module\n * Handles all messages between TypeScript and Flutter via postMessage\n */\nclass FlutterBridge {\n    constructor() {\n        this.pendingCalls = new Map();\n        this.callId = 0;\n        // Listen for responses from Flutter\n        this.setupMessageListener();\n    }\n    setupMessageListener() {\n        // Flutter sends responses back via window.addEventListener('message')\n        window.addEventListener('message', (event) => {\n            const data = event.data;\n            if (data?.type?.startsWith('response.') && data.callId) {\n                this.handleResponse(data.callId, data.payload);\n            }\n        });\n    }\n    handleResponse(callId, payload) {\n        const resolve = this.pendingCalls.get(callId);\n        if (resolve) {\n            resolve(payload);\n            this.pendingCalls.delete(callId);\n        }\n    }\n    generateCallId() {\n        return `ts_${++this.callId}_${Date.now()}`;\n    }\n    /**\n     * Send a message to Flutter and await response\n     */\n    async postMessage(type, payload) {\n        const callId = this.generateCallId();\n        return new Promise((resolve) => {\n            this.pendingCalls.set(callId, resolve);\n            const message = { type, callId, payload };\n            // Send via Flutter's JavaScriptChannel\n            if (window.FlutterBridge?.postMessage) {\n                window.FlutterBridge.postMessage(JSON.stringify(message));\n            }\n            else {\n                // Fallback for browser testing\n                console.log('[FlutterBridge] Message:', message);\n                resolve(undefined);\n            }\n        });\n    }\n    /**\n     * Register a native action handler (called from Flutter)\n     */\n    registerAction(name, handler) {\n        window[`__action_${name}__`] = handler;\n    }\n}\nexport const bridge = new FlutterBridge();\n", "/**\n * StateManager - Proxy for Dart state\n * All state changes go through Flutter bridge to Dart StateManager\n */\nimport { bridge } from './bridge';\nclass StateManager {\n    constructor() {\n        this.cache = new Map();\n    }\n    async get(key) {\n        // Always fetch from Dart for fresh data\n        const value = await bridge.postMessage('state.get', { key });\n        this.cache.set(key, value);\n        return value;\n    }\n    async set(key, value) {\n        this.cache.set(key, value);\n        await bridge.postMessage('state.set', { key, value });\n    }\n    async update(key, updater) {\n        const current = await this.get(key);\n        const next = updater(current);\n        await this.set(key, next);\n    }\n}\nexport const states = new StateManager();\n", "/**\n * ApiClient - HTTP client that proxies through Dart\n * Avoids CORS by using native Flutter HTTP clients\n */\nimport { bridge } from './bridge';\nclass ApiClient {\n    /**\n     * Make an HTTP request through Flutter's native HTTP client\n     * This bypasses browser CORS restrictions\n     */\n    async request(config) {\n        const response = await bridge.postMessage('api.request', {\n            url: config.url,\n            method: config.method ?? 'GET',\n            headers: config.headers ?? {},\n            body: config.body,\n            useFlutterProxy: config.useFlutterProxy ?? true,\n        });\n        return response.data;\n    }\n    async get(url, headers) {\n        return this.request({ url, method: 'GET', headers });\n    }\n    async post(url, body, headers) {\n        return this.request({ url, method: 'POST', body, headers });\n    }\n    async put(url, body, headers) {\n        return this.request({ url, method: 'PUT', body, headers });\n    }\n    async delete(url, headers) {\n        return this.request({ url, method: 'DELETE', headers });\n    }\n}\nexport const api = new ApiClient();\n", "/**\n * ActionRegistry - Manages action definitions\n * Actions are called from Flutter and run in TypeScript\n */\nimport { bridge } from './bridge';\nimport { states } from './states';\nimport { api } from './api';\nclass ActionRegistry {\n    constructor() {\n        this.actions = new Map();\n    }\n    register(name, handler) {\n        this.actions.set(name, handler);\n        bridge.registerAction(name, handler);\n        console.log('[ActionRegistry] Registered:', name);\n    }\n    get(name) {\n        return this.actions.get(name);\n    }\n    has(name) {\n        return this.actions.has(name);\n    }\n    async execute(name, params) {\n        const handler = this.actions.get(name);\n        if (!handler) {\n            console.error('[ActionRegistry] Action not found:', name);\n            return;\n        }\n        const context = {\n            states,\n            api,\n            log: (...args) => console.log(`[Action:${name}]`, ...args),\n        };\n        await handler(context, params);\n    }\n    list() {\n        return Array.from(this.actions.keys());\n    }\n}\nexport const registry = new ActionRegistry();\n/**\n * Define an action with proper TypeScript types\n *\n * @example\n * export const myAction = defineAction<AppState>('myAction', async ({ states, api, log }, params) => {\n *   const data = await states.get('key');\n *   await states.set('key', newValue);\n *   log('Done');\n * });\n */\nexport function defineAction(name, handler) {\n    const definition = { name, handler };\n    registry.register(name, handler);\n    return definition;\n}\n// Expose for Flutter to call\nwindow.__ui_eval_actions__ = {\n    execute: (name, params) => {\n        return registry.execute(name, params);\n    },\n    list: () => registry.list(),\n};\n", "/**\n * @ui_eval/sdk - TypeScript SDK for Flutter UI DSL\n *\n * Provides:\n * - `defineAction`: Register TypeScript action handlers\n * - `states`: Proxy to Dart state (get/set)\n * - `api`: HTTP client (proxied through Dart)\n *\n * @example\n * ```typescript\n * import { defineAction, states, api } from '@ui_eval/sdk';\n *\n * export const myAction = defineAction('myAction', async ({ states, log }) => {\n *   const count = await states.get('count');\n *   await states.set('count', count + 1);\n *   log('Count incremented');\n * });\n * ```\n */\nexport { defineAction, registry } from './actions';\nexport { states } from './states';\nexport { api } from './api';\nexport { bridge } from './bridge';\n// SDK loaded indicator\nconsole.log('[@ui_eval/sdk] SDK loaded v1.0.0');\n", "/**\n * Todo App Logic - TypeScript implementation\n * \n * This replaces the Dart action handlers with type-safe TypeScript\n */\n\nimport { defineAction, states, api } from '@ui_eval/sdk';\nimport type { ActionDefinition } from '@ui_eval/sdk';\nimport type { Todo } from './types';\n\n// Add a new todo\nconst addTodo: ActionDefinition = defineAction('addTodo', async ({ log }) => {\n  const title = await states.get<string>('newTodoTitle');\n  \n  if (!title || title.trim() === '') {\n    log('Cannot add empty todo');\n    return;\n  }\n\n  const todos = await states.get<Todo[]>('todos');\n  const newTodo: Todo = {\n    title: title.trim(),\n    completed: false,\n    createdAt: new Date().toISOString(),\n  };\n\n  await states.set('todos', [...todos, newTodo]);\n  await states.set('newTodoTitle', '');\n  \n  log('Added todo:', newTodo.title);\n});\n\n// Toggle todo completion status\nconst toggleTodo: ActionDefinition = defineAction('toggleTodo', async ({ log }, params) => {\n  const index = params?.index as number;\n  if (typeof index !== 'number') {\n    log('Invalid index for toggleTodo');\n    return;\n  }\n\n  const todos = await states.get<Todo[]>('todos');\n  \n  if (index < 0 || index >= todos.length) {\n    log('Index out of bounds:', index);\n    return;\n  }\n\n  const updatedTodos = [...todos];\n  updatedTodos[index] = {\n    ...updatedTodos[index],\n    completed: !updatedTodos[index].completed,\n  };\n\n  await states.set('todos', updatedTodos);\n  log('Toggled todo at index:', index);\n});\n\n// Delete a todo\nconst deleteTodo: ActionDefinition = defineAction('deleteTodo', async ({ log }, params) => {\n  const index = params?.index as number;\n  if (typeof index !== 'number') {\n    log('Invalid index for deleteTodo');\n    return;\n  }\n\n  const todos = await states.get<Todo[]>('todos');\n  \n  if (index < 0 || index >= todos.length) {\n    log('Index out of bounds:', index);\n    return;\n  }\n\n  const deleted = todos[index];\n  const updatedTodos = todos.filter((_t: Todo, i: number) => i !== index);\n  \n  await states.set('todos', updatedTodos);\n  log('Deleted todo:', deleted.title);\n});\n\n// Update new todo title input\nconst updateTitle: ActionDefinition = defineAction('updateTitle', async (_ctx, params) => {\n  const value = params?.value as string;\n  await states.set('newTodoTitle', value ?? '');\n});\n\n// Set filter\nconst setFilter: ActionDefinition = defineAction('setFilter', async ({ log }, params) => {\n  const filter = params?.filter as 'all' | 'active' | 'completed';\n  await states.set('filter', filter);\n  log('Filter set to:', filter);\n});\n\n// Clear all completed todos\nconst clearCompleted: ActionDefinition = defineAction('clearCompleted', async ({ log }) => {\n  const todos = await states.get<Todo[]>('todos');\n  const activeTodos = todos.filter((t: Todo) => !t.completed);\n  const clearedCount = todos.length - activeTodos.length;\n  \n  await states.set('todos', activeTodos);\n  log('Cleared', clearedCount, 'completed todos');\n});\n\n// Example: Fetch todos from API (using Dart proxy)\nconst fetchTodosFromApi: ActionDefinition = defineAction('fetchTodosFromApi', async ({ log }) => {\n  try {\n    log('Fetching todos from API...');\n    \n    // Using Flutter proxy to avoid CORS\n    const todos = await api.request({\n      url: 'https://jsonplaceholder.typicode.com/todos?_limit=5',\n      method: 'GET',\n      useFlutterProxy: true,\n    });\n    \n    // Transform API data to our format\n    const formattedTodos: Todo[] = (todos as any[]).map((t: any) => ({\n      title: t.title,\n      completed: t.completed,\n      createdAt: new Date().toISOString(),\n    }));\n    \n    await states.set('todos', formattedTodos);\n    log('Fetched', formattedTodos.length, 'todos');\n  } catch (error) {\n    log('Failed to fetch todos:', error);\n  }\n});\n\n// Export actions\nexport { addTodo, toggleTodo, deleteTodo, updateTitle, setFilter, clearCompleted, fetchTodosFromApi };\n\nconsole.log('[TodoLogic] Actions registered');\n", "/**\n * Main entry point for TypeScript logic\n */\n\nimport '@ui_eval/sdk';\nimport './todoLogic';\n\nconsole.log('[Logic] Bundle loaded');\n"],
  "mappings": "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",
  "names": []
}
